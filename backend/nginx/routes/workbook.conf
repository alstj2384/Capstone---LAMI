# /api/workbook (GET은 인증 없이, POST는 인증 필요)
location ~ ^/api/workbook/?$ {
    access_by_lua_block {
        local jwt_auth = require("jwt_auth")
        jwt_auth.check()
    }
    proxy_pass http://workbook-service;
}

# /api/workbook/{id} (GET은 인증 없이, PATCH/DELETE는 인증 필요)
location ~ ^/api/workbook/\d+$ {
    access_by_lua_block {
        local jwt_auth = require("jwt_auth")
        jwt_auth.check()
    }
    proxy_pass http://workbook-service;
}

# /api/workbook/list 는 인증 없이 항상 허용
location = /api/workbook/list {
    proxy_pass http://workbook-service;
}

# 문제 관련 요청들 (모두 인증 없이)
location ~ ^/api/problem/\d+$ {
    proxy_pass http://workbook-service;
}
location ~ ^/api/problem/list/\d+$ {
    proxy_pass http://workbook-service;
}
location /api/problem/ {
    proxy_pass http://workbook-service;
}